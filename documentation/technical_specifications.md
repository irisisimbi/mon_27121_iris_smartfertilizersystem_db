# Technical Specifications

## Smart Fertilizer Recommendation System

This document provides detailed technical specifications for the Smart Fertilizer Recommendation System.

---

## System Requirements

### Hardware Requirements

**Minimum:**
- Processor: Dual-core 2.0 GHz
- RAM: 4 GB
- Storage: 10 GB available space
- Network: 10 Mbps

**Recommended:**
- Processor: Quad-core 3.0 GHz or higher
- RAM: 8 GB or more
- Storage: 50 GB SSD
- Network: 100 Mbps or higher

### Software Requirements

**Database Server:**
- Oracle Database 11g Release 2 or higher
- Oracle Database 12c (recommended)
- Oracle Database 19c or 21c (fully compatible)

**Development Tools:**
- Oracle SQL Developer 4.0 or higher
- SQL*Plus (included with Oracle Database)

**Operating System:**
- Windows Server 2012 R2 or higher
- Linux (RHEL 7+, Ubuntu 18.04+, Oracle Linux 7+)
- Oracle Solaris 11+

---

## Database Specifications

### Database Configuration

```sql
-- Character Set
NLS_CHARACTERSET: AL32UTF8
NLS_NCHAR_CHARACTERSET: AL16UTF16

-- Tablespace
DEFAULT TABLESPACE: USERS
TEMPORARY TABLESPACE: TEMP

-- Memory Settings (Recommended)
SGA_TARGET: 2G
PGA_AGGREGATE_TARGET: 1G
```

### Schema Information

```sql
-- Schema Name: FERTILIZER_SYSTEM (or user-defined)
-- Default Tablespace: USERS
-- Temporary Tablespace: TEMP
```

### Database Objects Summary

| Object Type | Count | Names |
|------------|-------|-------|
| Tables | 7 | farmer, lab_user, soil_test, fertilizer, recommendation, audit_log, holiday |
| Procedures | Variable | recommend_fertilizer, generate_report, etc. |
| Functions | Variable | calculate_deficit, validate_nutrients, etc. |
| Triggers | Variable | audit triggers, validation triggers |
| Packages | Variable | pkg_fertilizer_mgmt, pkg_analytics |
| Sequences | 0 | (Using IDENTITY columns instead) |

---

## Table Specifications

### 1. FARMER Table

```sql
CREATE TABLE farmer (
  farmer_id   NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  farm_name   VARCHAR2(100) NOT NULL,
  location    VARCHAR2(100)
);
```

**Technical Details:**
- **Primary Key:** farmer_id (auto-generated)
- **Identity Column:** farmer_id starts at 1, increments by 1
- **Storage:** Approximately 200 bytes per row
- **Estimated Rows:** 1,000-10,000
- **Indexes:** PK index on farmer_id

**Constraints:**
- `PK_FARMER`: Primary key on farmer_id
- `NN_FARM_NAME`: NOT NULL on farm_name

### 2. LAB_USER Table

```sql
CREATE TABLE lab_user (
  user_id   NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  username  VARCHAR2(50) UNIQUE NOT NULL,
  role      VARCHAR2(30)
);
```

**Technical Details:**
- **Primary Key:** user_id (auto-generated)
- **Unique Constraint:** username
- **Storage:** Approximately 80 bytes per row
- **Estimated Rows:** 10-100
- **Indexes:** PK index on user_id, Unique index on username

**Constraints:**
- `PK_LAB_USER`: Primary key on user_id
- `UK_USERNAME`: Unique constraint on username
- `NN_USERNAME`: NOT NULL on username

### 3. SOIL_TEST Table

```sql
CREATE TABLE soil_test (
  soil_id    NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  farmer_id  NUMBER NOT NULL,
  lab_user_id NUMBER NOT NULL,
  nitrogen   NUMBER CHECK (nitrogen >= 0),
  phosphorus NUMBER CHECK (phosphorus >= 0),
  potassium  NUMBER CHECK (potassium >= 0),
  test_date  DATE DEFAULT SYSDATE,
  CONSTRAINT fk_soil_farmer FOREIGN KEY (farmer_id) REFERENCES farmer(farmer_id),
  CONSTRAINT fk_soil_user   FOREIGN KEY (lab_user_id) REFERENCES lab_user(user_id)
);
```

**Technical Details:**
- **Primary Key:** soil_id (auto-generated)
- **Foreign Keys:** farmer_id, lab_user_id
- **Storage:** Approximately 100 bytes per row
- **Estimated Rows:** 10,000-100,000
- **Indexes:** PK index on soil_id, FK indexes recommended

**Constraints:**
- `PK_SOIL_TEST`: Primary key on soil_id
- `FK_SOIL_FARMER`: Foreign key to farmer(farmer_id)
- `FK_SOIL_USER`: Foreign key to lab_user(user_id)
- `CK_NITROGEN`: Check nitrogen >= 0
- `CK_PHOSPHORUS`: Check phosphorus >= 0
- `CK_POTASSIUM`: Check potassium >= 0
- `NN_FARMER_ID`: NOT NULL on farmer_id
- `NN_LAB_USER_ID`: NOT NULL on lab_user_id

**Recommended Additional Indexes:**
```sql
CREATE INDEX idx_soil_farmer ON soil_test(farmer_id);
CREATE INDEX idx_soil_date ON soil_test(test_date);
CREATE INDEX idx_soil_user ON soil_test(lab_user_id);
```

### 4. FERTILIZER Table

```sql
CREATE TABLE fertilizer (
  fertilizer_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  fertilizer_name VARCHAR2(50) UNIQUE NOT NULL,
  nutrient_type VARCHAR2(20) NOT NULL,
  recommended_amount NUMBER
);
```

**Technical Details:**
- **Primary Key:** fertilizer_id (auto-generated)
- **Unique Constraint:** fertilizer_name
- **Storage:** Approximately 90 bytes per row
- **Estimated Rows:** 50-200
- **Indexes:** PK index on fertilizer_id, Unique index on fertilizer_name

**Constraints:**
- `PK_FERTILIZER`: Primary key on fertilizer_id
- `UK_FERT_NAME`: Unique constraint on fertilizer_name
- `NN_FERT_NAME`: NOT NULL on fertilizer_name
- `NN_NUTRIENT_TYPE`: NOT NULL on nutrient_type

### 5. RECOMMENDATION Table

```sql
CREATE TABLE recommendation (
  rec_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  soil_id NUMBER NOT NULL,
  fertilizer_id NUMBER,
  recommendation_text VARCHAR2(4000),
  rec_date DATE DEFAULT SYSDATE,
  approved_by NUMBER,
  CONSTRAINT fk_rec_soil FOREIGN KEY (soil_id) REFERENCES soil_test(soil_id),
  CONSTRAINT fk_rec_fert FOREIGN KEY (fertilizer_id) REFERENCES fertilizer(fertilizer_id)
);
```

**Technical Details:**
- **Primary Key:** rec_id (auto-generated)
- **Foreign Keys:** soil_id, fertilizer_id
- **Storage:** Approximately 4100 bytes per row (due to VARCHAR2(4000))
- **Estimated Rows:** 10,000-100,000
- **Indexes:** PK index on rec_id

**Constraints:**
- `PK_RECOMMENDATION`: Primary key on rec_id
- `FK_REC_SOIL`: Foreign key to soil_test(soil_id)
- `FK_REC_FERT`: Foreign key to fertilizer(fertilizer_id)
- `NN_SOIL_ID`: NOT NULL on soil_id

**Recommended Additional Indexes:**
```sql
CREATE INDEX idx_rec_soil ON recommendation(soil_id);
CREATE INDEX idx_rec_date ON recommendation(rec_date);
CREATE INDEX idx_rec_fert ON recommendation(fertilizer_id);
```

### 6. AUDIT_LOG Table

```sql
CREATE TABLE audit_log (
  audit_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  username VARCHAR2(50),
  operation VARCHAR2(20),
  object_type VARCHAR2(30),
  object_id NUMBER,
  attempt_time TIMESTAMP WITH TIME ZONE DEFAULT SYSTIMESTAMP,
  status VARCHAR2(20),
  message VARCHAR2(4000)
);
```

**Technical Details:**
- **Primary Key:** audit_id (auto-generated)
- **Storage:** Approximately 4200 bytes per row
- **Estimated Rows:** Unlimited (grows continuously)
- **Indexes:** PK index on audit_id
- **Partitioning:** Consider range partitioning by attempt_time for large volumes

**Constraints:**
- `PK_AUDIT_LOG`: Primary key on audit_id

**Recommended Additional Indexes:**
```sql
CREATE INDEX idx_audit_time ON audit_log(attempt_time);
CREATE INDEX idx_audit_user ON audit_log(username);
CREATE INDEX idx_audit_status ON audit_log(status);
```

**Partitioning Strategy (for high-volume systems):**
```sql
-- Partition by month
ALTER TABLE audit_log
MODIFY
PARTITION BY RANGE (attempt_time)
INTERVAL (NUMTOYMINTERVAL(1,'MONTH'))
(PARTITION p_initial VALUES LESS THAN (TIMESTAMP '2025-01-01 00:00:00'));
```

### 7. HOLIDAY Table

```sql
CREATE TABLE holiday (
  holiday_id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  holiday_date DATE UNIQUE NOT NULL,
  description VARCHAR2(200)
);
```

**Technical Details:**
- **Primary Key:** holiday_id (auto-generated)
- **Unique Constraint:** holiday_date
- **Storage:** Approximately 220 bytes per row
- **Estimated Rows:** 50-100
- **Indexes:** PK index on holiday_id, Unique index on holiday_date

**Constraints:**
- `PK_HOLIDAY`: Primary key on holiday_id
- `UK_HOLIDAY_DATE`: Unique constraint on holiday_date
- `NN_HOLIDAY_DATE`: NOT NULL on holiday_date

---

## Stored Procedures

### 1. RECOMMEND_FERTILIZER

**Purpose:** Analyzes soil test results and generates fertilizer recommendations

**Specification:**
```sql
CREATE OR REPLACE PROCEDURE recommend_fertilizer (
  p_soil_id IN NUMBER
)
IS
  -- Local variables
  v_nitrogen NUMBER;
  v_phosphorus NUMBER;
  v_potassium NUMBER;
  v_rec_text VARCHAR2(4000);
  v_fertilizer_id NUMBER;
BEGIN
  -- Implementation details
  NULL;
END;
```

**Parameters:**
- `p_soil_id` (IN NUMBER): The soil test ID to generate recommendation for

**Return Value:** None (procedure inserts into RECOMMENDATION table)

**Performance:**
- **Average Execution Time:** < 50ms
- **Maximum Execution Time:** < 200ms

**Error Handling:**
- `NO_DATA_FOUND`: Raised if soil_id doesn't exist
- `VALUE_ERROR`: Raised if invalid parameter type
- Custom exceptions for business rule violations

**Dependencies:**
- Reads from: SOIL_TEST, FERTILIZER
- Writes to: RECOMMENDATION
- Triggers: Audit log trigger fires on INSERT

### 2. UPDATE_SOIL_STATUS

**Purpose:** Updates the status of a soil test

**Specification:**
```sql
CREATE OR REPLACE PROCEDURE update_soil_status (
  p_soil_id IN NUMBER,
  p_status IN VARCHAR2
)
IS
BEGIN
  -- Implementation
  NULL;
END;
```

**Parameters:**
- `p_soil_id` (IN NUMBER): Soil test ID
- `p_status` (IN VARCHAR2): New status value

**Performance:**
- **Average Execution Time:** < 20ms

### 3. GENERATE_REPORT

**Purpose:** Generates comprehensive soil test and recommendation reports

**Specification:**
```sql
CREATE OR REPLACE PROCEDURE generate_report (
  p_farmer_id IN NUMBER,
  p_start_date IN DATE,
  p_end_date IN DATE,
  p_report OUT SYS_REFCURSOR
)
IS
BEGIN
  -- Implementation
  NULL;
END;
```

**Parameters:**
- `p_farmer_id` (IN NUMBER): Optional farmer filter
- `p_start_date` (IN DATE): Report start date
- `p_end_date` (IN DATE): Report end date
- `p_report` (OUT SYS_REFCURSOR): Result set

**Performance:**
- **Average Execution Time:** < 500ms
- **Maximum Records:** 10,000

---

## Functions

### 1. CALCULATE_NUTRIENT_DEFICIT

**Purpose:** Calculates the deficit for a specific nutrient

**Specification:**
```sql
CREATE OR REPLACE FUNCTION calculate_nutrient_deficit (
  p_current_level IN NUMBER,
  p_optimal_level IN NUMBER
)
RETURN NUMBER
IS
BEGIN
  RETURN p_optimal_level - p_current_level;
END;
```

**Parameters:**
- `p_current_level` (IN NUMBER): Current nutrient level
- `p_optimal_level` (IN NUMBER): Optimal nutrient level

**Return Type:** NUMBER (deficit amount, can be negative)

**Performance:**
- **Execution Time:** < 1ms
- **Deterministic:** Yes

### 2. GET_FERTILIZER_TYPE

**Purpose:** Determines optimal fertilizer type based on deficiencies

**Specification:**
```sql
CREATE OR REPLACE FUNCTION get_fertilizer_type (
  p_n_deficit IN NUMBER,
  p_p_deficit IN NUMBER,
  p_k_deficit IN NUMBER
)
RETURN VARCHAR2
IS
BEGIN
  -- Logic to determine fertilizer type
  RETURN 'NPK 15-15-15';
END;
```

**Parameters:**
- `p_n_deficit` (IN NUMBER): Nitrogen deficit
- `p_p_deficit` (IN NUMBER): Phosphorus deficit
- `p_k_deficit` (IN NUMBER): Potassium deficit

**Return Type:** VARCHAR2 (fertilizer type name)

**Performance:**
- **Execution Time:** < 5ms

### 3. VALIDATE_NUTRIENT_LEVELS

**Purpose:** Validates if nutrient levels are within acceptable ranges

**Specification:**
```sql
CREATE OR REPLACE FUNCTION validate_nutrient_levels (
  p_nitrogen IN NUMBER,
  p_phosphorus IN NUMBER,
  p_potassium IN NUMBER
)
RETURN BOOLEAN
IS
BEGIN
  -- Validation logic
  RETURN TRUE;
END;
```

**Return Type:** BOOLEAN (TRUE if valid, FALSE otherwise)

---

## Triggers

### 1. TRG_AUDIT_SOIL_INSERT

**Purpose:** Logs all soil test insertions to audit log

**Specification:**
```sql
CREATE OR REPLACE TRIGGER trg_audit_soil_insert
AFTER INSERT ON soil_test
FOR EACH ROW
BEGIN
  INSERT INTO audit_log (
    username, operation, object_type, object_id, status, message
  ) VALUES (
    USER, 'INSERT', 'SOIL_TEST', :NEW.soil_id, 'SUCCESS',
    'New soil test created for farmer_id: ' || :NEW.farmer_id
  );
END;
```

**Trigger Type:** AFTER INSERT, Row-level

**Performance Impact:** ~2-5ms per insert

**Error Handling:**
- Autonomous transaction to prevent rollback of audit log
- Exception handling to prevent main transaction failure

### 2. TRG_AUDIT_RECOMMENDATION

**Purpose:** Logs recommendation insertions and updates

**Specification:**
```sql
CREATE OR REPLACE TRIGGER trg_audit_recommendation
AFTER INSERT OR UPDATE ON recommendation
FOR EACH ROW
BEGIN
  -- Logging logic
  NULL;
END;
```

**Trigger Type:** AFTER INSERT OR UPDATE, Row-level

### 3. TRG_PREVENT_HOLIDAY_TEST

**Purpose:** Prevents soil test entries on holidays

**Specification:**
```sql
CREATE OR REPLACE TRIGGER trg_prevent_holiday_test
BEFORE INSERT ON soil_test
FOR EACH ROW
DECLARE
  v_is_holiday NUMBER;
BEGIN
  SELECT COUNT(*) INTO v_is_holiday
  FROM holiday
  WHERE holiday_date = TRUNC(:NEW.test_date);
  
  IF v_is_holiday > 0 THEN
    RAISE_APPLICATION_ERROR(-20001, 'Cannot create soil test on a holiday');
  END IF;
END;
```

**Trigger Type:** BEFORE INSERT, Row-level

**Error Code:** -20001 (custom application error)

---

## Packages

### 1. PKG_FERTILIZER_MGMT

**Purpose:** Centralized package for fertilizer management operations

**Specification:**
```sql
CREATE OR REPLACE PACKAGE pkg_fertilizer_mgmt AS
  -- Public type declarations
  TYPE rec_type IS RECORD (
    soil_id NUMBER,
    recommendation VARCHAR2(4000)
  );
  
  -- Public procedure declarations
  PROCEDURE add_fertilizer(
    p_name IN VARCHAR2,
    p_type IN VARCHAR2,
    p_amount IN NUMBER
  );
  
  PROCEDURE update_fertilizer(
    p_id IN NUMBER,
    p_amount IN NUMBER
  );
  
  -- Public function declarations
  FUNCTION get_fertilizer_id(
    p_name IN VARCHAR2
  ) RETURN NUMBER;
  
END pkg_fertilizer_mgmt;
```

**Package Body:**
```sql
CREATE OR REPLACE PACKAGE BODY pkg_fertilizer_mgmt AS
  -- Private constants
  c_max_amount CONSTANT NUMBER := 1000;
  
  -- Procedure implementations
  PROCEDURE add_fertilizer(...) IS
  BEGIN
    -- Implementation
    NULL;
  END;
  
  -- Function implementations
  FUNCTION get_fertilizer_id(...) RETURN NUMBER IS
  BEGIN
    -- Implementation
    RETURN NULL;
  END;
  
END pkg_fertilizer_mgmt;
```

### 2. PKG_ANALYTICS

**Purpose:** Analytics and reporting functions

**Components:**
- Monthly summary procedures
- Trend analysis functions
- Statistical calculations
- Report generation utilities

---

## Performance Specifications

### Query Performance Targets

| Query Type | Target Response Time | Maximum Response Time |
|-----------|---------------------|----------------------|
| Simple SELECT | < 10ms | < 50ms |
| JOIN (2-3 tables) | < 50ms | < 200ms |
| Complex Analytics | < 500ms | < 2s |
| Report Generation | < 1s | < 5s |

### Concurrent User Support

- **Maximum Concurrent Users:** 100
- **Recommended Concurrent Users:** 50
- **Transactions Per Second:** 100 TPS

### Database Size Estimates

| Component | Initial Size | 1 Year | 5 Years |
|-----------|-------------|---------|---------|
| Tables | 10 MB | 100 MB | 500 MB |
| Indexes | 5 MB | 50 MB | 250 MB |
| Audit Logs | 1 MB | 500 MB | 5 GB |
| **Total** | **16 MB** | **650 MB** | **5.75 GB** |

---

## Security Specifications

### Authentication

- Database user authentication required
- Username stored in LAB_USER table
- Password management handled by Oracle Database

### Authorization

**Role-Based Access:**
```sql
-- Lab Technician Role
GRANT SELECT, INSERT ON soil_test TO lab_technician_role;
GRANT SELECT ON farmer TO lab_technician_role;

-- Agronomist Role
GRANT SELECT, INSERT, UPDATE ON recommendation TO agronomist_role;
GRANT EXECUTE ON recommend_fertilizer TO agronomist_role;

-- Administrator Role
GRANT ALL PRIVILEGES ON ALL TABLES TO admin_role;
```

### Audit Requirements

- All INSERT, UPDATE, DELETE operations logged
- User actions tracked by username
- Timestamp with timezone for global operations
- Retention: Minimum 1 year, recommended 7 years

---

## API Specifications

### Future REST API Endpoints

**(Planned for future implementation)**

**Base URL:** `https://api.fertilizer-system.com/v1`

**Endpoints:**

1. **POST /soil-tests**
   - Creates new soil test
   - Request body: JSON with farmer_id, nutrient levels
   - Response: 201 Created, returns soil_id

2. **GET /soil-tests/:id**
   - Retrieves soil test details
   - Response: 200 OK, returns test data

3. **POST /recommendations**
   - Generates recommendation
   - Request body: soil_id
   - Response: 201 Created, returns recommendation

4. **GET /farmers/:id/history**
   - Retrieves farmer's test history
   - Response: 200 OK, returns array of tests

---

**Technical Specifications Version:** 1.0  
**Last Updated:** December 2025  
**Maintained By:** Isimbi Mushimire Iris (ID: 27121)